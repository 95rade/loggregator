#!/bin/bash

set -eu

function compile_linux() {
    local name=$1

    echo "building $name -- LINUX"
    GOOS=linux go build -o $workspace/bin/$name $name
    gzip -f $workspace/bin/$name
    bosh add-blob bin/$name.gz loggregator-blobs/$name.gz
}


workspace=$(realpath $(dirname "$0")/..)
export GOPATH=$workspace

compile_linux "metron"
compile_linux "doppler"
compile_linux "trafficcontroller"
compile_linux "syslog_drain_binder"

echo "building metron -- WIN"
GOOS=windows go build -o $workspace/bin/metron.exe metron

pushd $workspace
    bosh add-blob bin/metron.exe loggregator-blobs/metron.exe
popd
