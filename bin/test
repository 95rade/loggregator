#!/bin/bash

result=0

packages=(
    cfcomponent
    cfcomponent/instrumentation
    deaagent
    loggregator
    loggregator/agentlistener
    loggregator/authorization
    loggregator/groupedchannels
    loggregator/loggregator
    loggregator/logtarget
    loggregator/messagestore
    loggregator/sink
    loggregatorclient
    logmessage
    registrar
    testhelpers
);

for package in "${packages[@]}"
do
    echo -e "\n Testing package $package"
    $(dirname $0)/go fmt $package
    $(dirname $0)/go test -i --race $package
    $(dirname $0)/go test -v --race $package
    let "result += $?"
done

echo -e "\n Running build script to confirm main compiles"
$(dirname $0)/build
let "result += $?"
rm -f deaagent loggregator

if [ $result -eq 0 ]; then
	echo -e "\nSUITE SUCCESS"
else
	echo -e "\nSUITE FAILURE"
fi

exit $result

