<%
  etcd_machines = []
  if_p("etcd.machines") do |machines|
    etcd_machines = machines
  end

  if_p("loggregator.etcd.machines") do |machines|
    etcd_machines = machines
  end
%>
{
    "JobName": "<%= name %>",
    "JobIndex": <%= spec.index %>,
    "EtcdUrls": [<%= etcd_machines.map{|addr| "\"http://#{addr}:4001\""}.join(",")%>],
    "EtcdMaxConcurrentRequests": <%= p("etcd.maxconcurrentrequests") %>,
    "OutgoingDropsondePort": <%= p("loggregator.outgoing_dropsonde_port") %>,
    "DopplerPort": <%= p("loggregator.doppler_port") %>,
    "OutgoingPort": <%= p("traffic_controller.outgoing_port") %>,
    "SkipCertVerify": <%= p("ssl.skip_cert_verify") %>,
    "SharedSecret": "<%= p("loggregator_endpoint.shared_secret") %>",
    "Zone": "<%= p("traffic_controller.zone") %>",
    "ApiHost": "<%= p("cc.srv_api_uri") %>",
    "SystemDomain": "<%= p("system_domain") %>",
    "MetronPort": <%= p("metron_endpoint.dropsonde_port") %>,
    <% scheme = p("uaa.no_ssl") ? "http" : "https"
        domain = p("system_domain") %>
    "UaaHost": "<%= p("uaa.url", "#{scheme}://uaa.#{domain}") %>",
    "UaaClientId": "<%= p("doppler.uaa_client_id") %>",
    "UaaClientSecret": "<%= p("uaa.clients.doppler.secret") %>"
    <% if_p("syslog_daemon_config") do |_| %>
    , "Syslog": "vcap.trafficcontroller"
    <% end %>
}
